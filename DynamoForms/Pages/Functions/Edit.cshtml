@page "/Functions/Edit"
@model TableEditModel

<h2>Edit Record (@Model.EditId) in @Model.TableName</h2>
<form method="post">
    @foreach (var col in Model.Columns.Where(c => !c.IsPrimaryKey))
    {
        <div class="mb-2">
            <label>@col.Label</label>
            @if (col.Type == "bit")
            {
                <input type="checkbox"
                       name="EditRecord[@col.Label]"
                       value="True"
                       @(Model.EditRecord.ContainsKey(col.Label) &&
                                      (Model.EditRecord[col.Label] == "True" || Model.EditRecord[col.Label] == "true" || Model.EditRecord[col.Label] == "1")
                          ? "checked" : "") />
            }
            else if (col.Type == "date")
            {
                <input type="date"
                       class="form-control"
                       name="EditRecord[@col.Label]"
                       value="@(Model.EditRecord.ContainsKey(col.Label) && DateTime.TryParse(Model.EditRecord[col.Label], out var dtVal) ? dtVal.ToString("yyyy-MM-dd") : "")" />
            }
            else if (col.Type == "datetime")
            {
                <input type="text"
                       class="form-control"
                       name="EditRecord[@col.Label]"
                       value="@(Model.EditRecord.ContainsKey(col.Label) ? Model.EditRecord[col.Label] : "")"
                       readonly />
            }
            else if (col.Type == "int" || col.Type == "bigint" || col.Type == "smallint" || col.Type == "tinyint")
            {
                <input type="number"
                       class="form-control"
                       name="EditRecord[@col.Label]"
                       value="@(Model.EditRecord.ContainsKey(col.Label) ? Model.EditRecord[col.Label] : "")" />
            }
            else
            {
                <input class="form-control"
                       name="EditRecord[@col.Label]"
                       value="@(Model.EditRecord.ContainsKey(col.Label) ? Model.EditRecord[col.Label] : "")"
                       maxlength="@col.Length" />
            }
        </div>
    }
    <button type="submit" class="btn btn-success">Save</button>
    <a class="btn btn-secondary" asp-page="/Content/List" asp-route-app="@Model.TableName">Cancel</a>
</form>
@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success mt-2">@Model.Message</div>
}